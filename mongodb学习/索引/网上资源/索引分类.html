<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <ul>
        <li>
            默认索引_id：mg有个默认的“_id”的键，它相当于“主键”的角色。集合创建之后系统会自动创建一个索引在“_id”键上，他是默认索引，索引名叫“_id”，是无法被删除的，_id的值也是恒定不变的。该索引可以防止客户端插入两个具有相同值得文档。
        </li>
        <li>
            单键索引：索引值为单一的值，比如字符串，更新日期等等。对于单键索引和排序操作，索引键的排序顺序并不重要，因为mg可以在任何一方向遍历索引。
        </li>
        <li>
            多键索引：索引值为多个值同时存在，比如数组，也就是说，如果在一个值为数组的字段上面创建索引，mg会自己决定，是否要把这个索引建成多键索引。
            <ul>
                <li>
                    要索引一个包含数组值的字段，mg会为数组中的每个元素创建一个索引键，这些多键索引支持针对数组字段的高效查询。多键索引可以在包含标量值（字符串，数字）和嵌套文档上的数组上构造。
                </li>
                <li>
                    mg会跟踪那些索引字段会成为多键索引，跟踪这些信息可以让mg查询引擎使用更紧密的索引界限。
                </li>
            </ul>
        </li>
        <li>
            复合索引：单键索引和多键索引的结合。复合索引可以支持在多个字段上匹配的查询。当查询的值不只有一个的时候，就需要建立复合索引。
            <ul>
                <li>
                    索引规范中字段的值描述了该字段的索引类型，一个值1指定按升序排列项目的索引，值-1指定以降序对项目进行排序的索引。
                </li>
                <li>
                    复合索引中列出的字段的顺序很重要。决定该索引在查询过程中能否被用到  db.persons.find().sort({name:1,age:1})
                    db.persons.find().sort({name:-1,age:-1}) 只有这两种情况是可以使用到索引的，
                </li>
                <li>
                    支持前导列索引查询
                </li>
                <li>
                    不能创建基于哈希值索引类型的复合索引
                </li>
                <li>
                    任意符合索引字段不能超过31个。
                </li>
                <li>
                    前缀：索引字段的开始子集。 {"item":1,"location":1,"stock":1}
                    <ul>
                        <li>
                            该索引具有以下索引前缀：{item:1},{item:1,location:1}
                        </li>
                        <li>
                            具体的方法看不懂
                        </li>
                        <li>
                            mg会在所有使用前缀索引的情况下使用复合索引。
                        </li>
                    </ul>
                </li>
                <li>
                    索引交集：mg支持使用索引交叉来完成查询，创建支持查询的符合索引或依赖索引较差的选择取决于系统的具体情况。
                </li>
                <li>

                </li>
            </ul>
        </li>
        <li>
            过期索引：在一段时间时候会自动销毁记录的索引，适合于处理用户登陆信息等具有时间局限的记录过期处理，比较多的是session和cookie，对一些存储日志做过期处理等用途。db.collection.createIndex({time:1},{expireAfterSeconds:10})
            <ul>
                <li>
                    存储在过期索引字段的值必须是指定的时间类型，必须是ISODate，或者ISODate数组，不能使用时间戳。否则不能被自动删除
                </li>
                <li>
                    如果指定了ISODate数组，则按照最小事件进行删除
                </li>
                <li>
                    过期索引不能使符合索引
                </li>
                <li>
                    删除时间并不是精确的，删除过程是后台程序每60s跑一次，而且删除也需要一些时间，所以存在误差。
                </li>
            </ul>
        </li>
        <li>
            全文索引：主要用于搜索业务的索引，通过对不同查询方式和条件进行mg全文索引，适合搜索引擎和站内搜索业务。（利用全文索引相似度可以实现对查询结果进行相似度排序，从而实现一个简单的小搜索相似度排序，类似于谷歌百度查询相似度排序）
            <big>
                全文索引用于在文档中搜索文本，我们也可以使用正则表达式来查询字符串，但是当文本块比较大的时候，正则表达式搜索会非常慢。而且无法处理语言理解的问题，使用全文搜索可以非常快速的进行文本搜索，如同内置了多种语言的分词机制支持一样。但是创建索引的开销非常大，全文索引的开销更大
            </big>
        </li>
        <li>
            地理位置索引：根据区间值进行范围索引查询，这种索引适合越来越流行的打车软件查询人车位置时通过索引提升查询效率，还有网购点餐时查询自己距离范围内的餐厅地址等。
            <ul>
                <li>
                    2D索引：平面位置
                </li>
                <li>
                    2Dsphere索引:
                </li>

            </ul>
        </li>
        <li>
            创建内嵌领域的索引：可以实现在对象值的查找 contributes.duty 
            <ul>
                <li>
                    但是人家原来不创建也是可以找到的。db.getCollection('logins').find({"contributes.duty":"啥也没干，就是中了500万"}) 注意前面要加双括号。
                </li>
                <li>
                    可以在对向内部任何一个字段上创建索引，创建的索引将支持在该字段上的查询。也可以拿整个对象来创建,比如contributes。
                </li>
            </ul>
        </li>
    </ul>
    <h1>
        注意
    </h1>
    <ul>
        <li>
            索引的最终目的是提升查询效率和速度，索引不能过多，需要理性创建最合适的。
        </li>
        <li>
            过期索引：
            <ul>
                <li>
                    存储的字段值必须指定的时间类型ISDate或者ISDate数组，不能使用时间戳，否则索引会失效。
                </li>
                <li>
                    记录自动销毁进程是每60s跑一次后台程序，并不是很准时的自动程序
                </li>
                <li>
                    如果指定了ISODate数组，那么程序会自动把数组内时间最早的记录销毁
                </li>
                <li>
                    过期索引不能被复合索引所使用
                </li>
            </ul>
        </li>
    </ul>

    <h1>
        索引属性选项配置
    </h1>
    <ul>
        <li>
            background:Boolean。建立索引的时候可能会阻塞其他数据库的操作，background可以指定以后台的方式创建索引。即增加“background”可选参数。也就是说，如果您的应用程序需要能够在构建索引时访问数据，可以在后台构建索引。
        </li>
        <li>
            unique：Boolean.建立的索引是否唯一。指定为true创建唯一索引，默认值为false.
        </li>
        <li>
            name：Strng。如果未指定，mg通过链接索引的字段名和排序顺序生成一个索引名称。
        </li>
        <li>
            partialFilterExpression:设定索引只对满足条件的文档起作用
        </li>
        <li>
            spares:对文档中不存在字段数据不启用索引，稀疏性 true.不必为不存在的数据创建索引。
        </li>
        <li>
            expireAfterSeconds指定TTL，过期索引。
        </li>
    </ul>
</body>
</html>