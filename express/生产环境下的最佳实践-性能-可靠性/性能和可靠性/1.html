<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <h1>性能和可靠性</h1>
    <ul>
        <li>
            需要对代码做的事情
            <ul>
                <li>
                    gzip压缩
                </li>
                <li>
                    禁止使用同步方法：同步方法会在他返回之前一直阻塞线程，一次单独的调用可能影响不大，但是在流量非常巨大的生产环境中，是不可接受的。

                </li>
                <li>
                    使用中间件来提供静态文件:更好的选择是在反向代理层上面提供静态文件。
                </li>
                <li>
                    适当的打印日志
                    <ul>
                        <li>
                            调试：console.log()
                        </li>
                        <li>
                            记录操作：为了记录应用的活动而打印日志。Bunyan
                        </li>
                    </ul>
                </li>
                <li>
                    合理的处理异常
                    <ul>
                        <li>
                            如何避免node崩溃，执行合理的异常捕获并处理异常。离线重启工具
                        </li>
                        <li>
                            多进程
                        </li>
                        <li>
                            自动重启
                        </li>
                        <li>
                            try-catch:try-catch只能捕获同步代码的异常，但是NodeJs里面仅仅是异步的，所以对大多数的异常都是无能为力的。
                        </li>
                        <li>
                            promise处理异常
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li>
            需要对环境做的事
            <ul>
                <li>
                    将NODe_ENV设置为“production” app.set('env', 'production')
                    <ul>
                        <li>
                            缓存视图模板
                        </li>
                        <li>
                            缓存css文件
                        </li>
                        <li>
                            生成更简洁的错误信息
                        </li>
                    </ul>
                </li>
                <li>
                    保证你的应用在发生错误后自动重启
                    <ul>
                        <li>
                            使用一个进程管理员，来重启你的应用 process manager,当你的操作系统崩溃时，使用它提供的初始化系统来重启你的应用。
                        </li>
                        <li>
                            node 应用在遇到异常时就会退出，所以必须要做好代码测试，并且合理的处理了所有异常，如果有万一 ，准备一个机制来确保他的自动重启
                        </li>
                        <li>
                            进程管理员除了可以自动重启应用
                            <ul>
                                <li>
                                    还可以获得当前运行环境的性能表现和资源消耗情况
                                </li>
                                <li>
                                    自动的修改变量环境设置
                                </li>
                                <li>
                                    管理集群
                                </li>
                            </ul>
                        </li>
                        <li>
                            初始化系统：当你的服务器重启的时候，你的应用也会相应的重启。
                            <ul>
                                <li>
                                    systemd
                                </li>
                                <li>
                                    Upstart
                                </li>
                                <li>
                                    具体方法：将你的应用运行于一个进程管理员中，然后将进程管理员设置为系统的一个服务。
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>
                    使用集群模式运行你的应用。
                    <ul>
                        <li>
                            在多核系统中，你可以通过启动一个进程集群来成倍的提升你的应用性能，一个集群运行了你的多个实例，理想情况下，一个cpu核对应一个实例，这样你可以在多个实例进行负载均衡。在集群中，一个工作进程的崩溃不会影响到其他的工作进程，所以除了性能因素之外，单独的进程崩溃的相互不影响也是另一个使用集群的好处。一个进程崩溃之后，请确保记录下日志，然后重新通过cluster.fork()创建一个新的工作进程。
                        </li>
                        <li>
                            node-pm或者cluser-service
                        </li>
                    </ul>
                </li>
                <li>
                    缓存请求结果：一个Nginx这样的缓存服务器可以极大的提升网站的响应速度
                </li>
                <li>
                    使用负载均衡：一个负载均衡器实际上是一个反向代理，他接受负载，并将其均衡的分配给给个实例或者服务器。使用了负载均衡以后，你可以保证每个请求都根据他的来源设置了独特的session id。
                </li>
                <li>
                    使用反向代理：一个反向代理被设置在web应用之前，用于支持对各类请求的操作，如将请求发送给应用，自动处理错误页面，压缩，缓存静态文件，负载均衡。等等
                </li>
            </ul>
        </li>
    </ul>
</body>
</html>